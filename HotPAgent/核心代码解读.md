# HotPAgent æ ¸å¿ƒä»£ç è§£è¯»æ–‡æ¡£

> **ä¸€å¥è¯æ€»ç»“**ï¼šHotPAgent æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¤šå¹³å°çƒ­æ¦œçˆ¬å–ç³»ç»Ÿï¼Œé€šè¿‡ LLM è¯­ä¹‰åˆ†æå’Œå¤šç»´åº¦è¯„åˆ†ç®—æ³•ï¼Œæ™ºèƒ½è¯†åˆ«ç¤¾ä¼šçº§çˆ†ç‚¹è¯é¢˜ã€‚

---

## è¿è¡Œ

```powershell
#å¯åŠ¨è™šæ‹Ÿç¯å¢ƒ
.\.venv\Scripts\Activate.ps1

python main.py
```

å¦‚æœå‡ºç°.envæ–‡ä»¶ç¼“å­˜é—®é¢˜ï¼š

**PowerShell ä¼šè¯ç¼“å­˜äº†æ—§çš„ç¯å¢ƒå˜é‡ [OPENAI_API_KEY](file:///C:/Users/Administrator/Desktop/HotPAgent/config.py#L9-L9)**ï¼ˆå€¼ä¸ºæ—§ key `****B8JL`ï¼‰ï¼Œå³ä½¿é‡å¯ç»ˆç«¯å¹¶é‡æ–°æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œè¿™ä¸ªä¼šè¯çº§ç¯å¢ƒå˜é‡ä¾ç„¶å­˜åœ¨ã€‚

å½“ `python-dotenv` çš„ `load_dotenv()` é»˜è®¤è¡Œä¸ºæ˜¯**ä¸è¦†ç›–å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡**æ—¶ï¼Œå°±ç»§ç»­ç”¨äº†ç¼“å­˜çš„æ—§å€¼ï¼Œå¯¼è‡´ `.env` æ–‡ä»¶é‡Œçš„æ–° key æ²¡ç”Ÿæ•ˆã€‚

## è§£å†³æ–¹æ¡ˆ

æ¯æ¬¡è¿è¡Œå‰å…ˆæ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§ç¯å¢ƒå˜é‡ï¼š

```powershell
Remove-Item Env:\OPENAI_API_KEY -ErrorAction SilentlyContinue 
Remove-Item Env:\OPENAI_API_BASE -ErrorAction SilentlyContinue   
Remove-Item Env:\LLM_MODEL -ErrorAction SilentlyContinue 
python main.py
```

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„æ¦‚è§ˆ](#æ•´ä½“æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
   - [1. é…ç½®ç®¡ç† (config.py)](#1-é…ç½®ç®¡ç†-configpy)
   - [2. æ•°æ®æ¨¡å‹ (models.py)](#2-æ•°æ®æ¨¡å‹-modelspy)
   - [3. çˆ¬è™«ç³»ç»Ÿ (scrapers/)](#3-çˆ¬è™«ç³»ç»Ÿ-scrapers)
   - [4. LLM åˆ†æå™¨ (llm_analyzer.py)](#4-llm-åˆ†æå™¨-llm_analyzerpy)
   - [5. è¯„åˆ†å¼•æ“ (scoring_engine.py)](#5-è¯„åˆ†å¼•æ“-scoring_enginepy)
   - [6. Agent ä¸»æ§ (agent.py)](#6-agent-ä¸»æ§-agentpy)
   - [7. ç¨‹åºå…¥å£ (main.py)](#7-ç¨‹åºå…¥å£-mainpy)
3. [æ•°æ®æµå›¾](#æ•°æ®æµå›¾)
4. [å…³é”®è®¾è®¡æ¨¡å¼](#å…³é”®è®¾è®¡æ¨¡å¼)

---

## æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    main.py (å…¥å£)                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚   Config (é…ç½®åŠ è½½)       â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                         â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚              â”‚  HotTopicAgent       â”‚  ä¸»æ§åˆ¶å™¨          â”‚
â”‚              â”‚  (åè°ƒå„æ¨¡å—)         â”‚                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                         â”‚                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â–¼               â–¼               â–¼              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚Scrapers â”‚    â”‚   LLM    â”‚   â”‚ Scoring  â”‚         â”‚
â”‚   â”‚(çˆ¬è™«)   â”‚â”€â”€â”€â–¶â”‚Analyzer  â”‚â”€â”€â–¶â”‚  Engine  â”‚         â”‚
â”‚   â”‚         â”‚    â”‚(è¯­ä¹‰åˆ†æ)â”‚   â”‚(ç»¼åˆè¯„åˆ†)â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚        â”‚                                â”‚              â”‚
â”‚        â–¼                                â–¼              â”‚
â”‚   HotTopic                        EnrichedTopic        â”‚
â”‚   (åŸå§‹æ•°æ®)                      (æœ€ç»ˆç»“æœ)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. é…ç½®ç®¡ç† (config.py)

**æ ¸å¿ƒèŒè´£**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®å‚æ•°ï¼Œæ”¯æŒç¯å¢ƒå˜é‡åŠ è½½ã€‚

```python
import os
from dotenv import load_dotenv

load_dotenv()  # ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡

class Config:
    """å…¨å±€é…ç½®ç±»"""
    
    # LLM é…ç½®
    OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")
    OPENAI_API_BASE = os.getenv("OPENAI_API_BASE", "https://api.openai.com/v1")
    LLM_MODEL = os.getenv("LLM_MODEL", "gpt-4-turbo-preview")
    
    # è¯„åˆ†é˜ˆå€¼
    SCORE_THRESHOLD = int(os.getenv("SCORE_THRESHOLD", 80))
    
    # è°ƒåº¦é—´éš”ï¼ˆå°æ—¶ï¼‰
    SCHEDULE_INTERVAL = int(os.getenv("SCHEDULE_INTERVAL", 1))
    
    # è¾“å‡ºç›®å½•
    OUTPUT_DIR = os.getenv("OUTPUT_DIR", "./output")
    
    # çˆ¬å–æ•°é‡é…ç½®
    FETCH_LIMIT = 50
    
    # è¯„åˆ†æƒé‡
    WEIGHT_HEAT = 0.5        # çƒ­åº¦æƒé‡
    WEIGHT_DISCUSSION = 0.3  # è®¨è®ºé‡æƒé‡
    WEIGHT_LLM = 0.2         # LLM è¯„åˆ†æƒé‡
    
    # å¹³å°é…ç½®
    PLATFORMS = {
        "weibo": {
            "name": "å¾®åš",
            "url": "https://s.weibo.com/top/summary",
            "enabled": True
        },
        "douyin": {
            "name": "æŠ–éŸ³",
            "url": "https://www.douyin.com/hot",
            "enabled": True
        },
        "zhihu": {
            "name": "çŸ¥ä¹",
            "url": "https://www.zhihu.com/hot",
            "enabled": True
        }
    }
    
    @classmethod
    def validate(cls):
        """éªŒè¯é…ç½®"""
        if not cls.OPENAI_API_KEY:
            raise ValueError("æœªè®¾ç½® OPENAI_API_KEYï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­é…ç½®")
        
        os.makedirs(cls.OUTPUT_DIR, exist_ok=True)
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… **ç¯å¢ƒå˜é‡ä¼˜å…ˆ**ï¼šæ”¯æŒé€šè¿‡ `.env` æ–‡ä»¶é…ç½®ï¼Œä¾¿äºéƒ¨ç½²
- âœ… **ç±»å±æ€§è®¾è®¡**ï¼šå…¨å±€å•ä¾‹ï¼Œé¿å…é‡å¤å®ä¾‹åŒ–
- âœ… **é»˜è®¤å€¼å…œåº•**ï¼šæ‰€æœ‰é…ç½®éƒ½æœ‰åˆç†çš„é»˜è®¤å€¼
- âœ… **validate() æ–¹æ³•**ï¼šå¯åŠ¨æ—¶éªŒè¯å¿…è¦é…ç½®ï¼Œæå‰å‘ç°é—®é¢˜

**å…³é”®é…ç½®è§£è¯»**ï¼š
- `WEIGHT_HEAT/DISCUSSION/LLM`ï¼šä¸‰ä¸ªæƒé‡åŠ èµ·æ¥ç­‰äº 1.0ï¼Œå†³å®šæœ€ç»ˆè¯„åˆ†çš„ç»„æˆ
- `SCORE_THRESHOLD`ï¼šåˆ¤å®š"çˆ†ç‚¹è¯é¢˜"çš„åˆ†æ•°çº¿ï¼Œé»˜è®¤ 80 åˆ†
- `FETCH_LIMIT`ï¼šæ¯ä¸ªå¹³å°æŠ“å–çš„æ•°é‡ä¸Šé™

---

### 2. æ•°æ®æ¨¡å‹ (models.py)

**æ ¸å¿ƒèŒè´£**ï¼šä½¿ç”¨ Pydantic å®šä¹‰å¼ºç±»å‹æ•°æ®ç»“æ„ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

```python
from typing import Optional, Literal
from pydantic import BaseModel, Field

# æ¨¡å‹ 1: åŸå§‹çƒ­æ¦œè¯é¢˜
class HotTopic(BaseModel):
    """çƒ­æ¦œè¯é¢˜æ•°æ®æ¨¡å‹"""
    platform: Literal["weibo", "douyin", "zhihu"] = Field(..., description="å¹³å°åç§°")
    title: str = Field(..., description="è¯é¢˜æ ‡é¢˜")
    heat_score: int = Field(..., description="åŸå§‹çƒ­åº¦å€¼")
    link: str = Field(..., description="è¯é¢˜é“¾æ¥")
    discussion_volume: Optional[int] = Field(None, description="è®¨è®ºé‡ï¼ˆè¯„è®º/å›ç­”æ•°ï¼‰")
    category: Optional[str] = Field(None, description="åˆ†ç±»æ ‡ç­¾")

# æ¨¡å‹ 2: LLM åˆ†æç»“æœ
class LLMAnalysis(BaseModel):
    """LLM åˆ†æç»“æœæ¨¡å‹"""
    topic_nature: str = Field(..., description="è¯é¢˜æ€§è´¨ï¼šå¨±ä¹/ç¤¾ä¼šæ–°é—»/ç§‘æŠ€/è™šå‡ä¿¡æ¯ç­‰")
    social_impact: int = Field(..., ge=1, le=10, description="ç¤¾ä¼šå½±å“åŠ›è¯„åˆ† 1-10")
    discussion_depth: int = Field(..., ge=1, le=10, description="è®¨è®ºæ·±åº¦è¯„åˆ† 1-10")
    potential_score: int = Field(..., ge=1, le=10, description="ç»¼åˆæ½œåŠ›åˆ† 1-10")
    reason: str = Field(..., description="è¯„åˆ†ç†ç”±")

# æ¨¡å‹ 3: æœ€ç»ˆç»“æœï¼ˆç»§æ‰¿ HotTopic + æ–°å¢è¯„åˆ†å­—æ®µï¼‰
class EnrichedTopic(HotTopic):
    """ç»è¿‡ LLM åˆ†æå’Œè¯„åˆ†åçš„è¯é¢˜"""
    llm_analysis: LLMAnalysis = Field(..., description="LLM åˆ†æç»“æœ")
    normalized_heat: float = Field(..., description="å½’ä¸€åŒ–çƒ­åº¦ 0-100")
    normalized_discussion: float = Field(..., description="å½’ä¸€åŒ–è®¨è®ºé‡ 0-100")
    total_score: float = Field(..., description="ç»¼åˆè¯„åˆ† 0-100")
    is_breakout: bool = Field(..., description="æ˜¯å¦ä¸ºçˆ†ç‚¹è¯é¢˜")
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… **æ¸è¿›å¼æ•°æ®å¢å¼º**ï¼š`HotTopic` â†’ `EnrichedTopic`ï¼Œæ•°æ®é€æ­¥ä¸°å¯Œ
- âœ… **ç±»å‹çº¦æŸ**ï¼š`Literal` é™åˆ¶å¹³å°åªèƒ½æ˜¯ä¸‰ä¸ªå€¼ä¹‹ä¸€ï¼Œ`ge/le` é™åˆ¶åˆ†æ•°èŒƒå›´
- âœ… **è‡ªåŠ¨éªŒè¯**ï¼šPydantic ä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨æ ¡éªŒæ•°æ®ç±»å‹å’ŒèŒƒå›´
- âœ… **æ–‡æ¡£åŒ–**ï¼š`Field(description=...)` ä¸ºæ¯ä¸ªå­—æ®µæä¾›æ¸…æ™°è¯´æ˜

**æ•°æ®æµè½¬**ï¼š
```
çˆ¬è™«æŠ“å– â†’ HotTopicï¼ˆåŸå§‹æ•°æ®ï¼‰
    â†“
LLM åˆ†æ â†’ LLMAnalysisï¼ˆè¯­ä¹‰åˆ†æç»“æœï¼‰
    â†“
è¯„åˆ†è®¡ç®— â†’ EnrichedTopicï¼ˆæœ€ç»ˆç»“æœï¼ŒåŒ…å«æ‰€æœ‰ä¿¡æ¯ï¼‰
```

---

### 3. çˆ¬è™«ç³»ç»Ÿ (scrapers/)

#### 3.1 åŸºç±»è®¾è®¡ (base_scraper.py)

**æ ¸å¿ƒèŒè´£**ï¼šå®šä¹‰çˆ¬è™«æ¥å£è§„èŒƒï¼Œæä¾›å…¬å…±æ–¹æ³•ã€‚

```python
from abc import ABC, abstractmethod
from typing import List
from models import HotTopic
from loguru import logger

class BaseScraper(ABC):
    """çˆ¬è™«åŸºç±»"""
    
    def __init__(self, platform: str):
        self.platform = platform
        logger.info(f"åˆå§‹åŒ– {platform} çˆ¬è™«")
    
    @abstractmethod
    async def fetch_hot_topics(self, limit: int = 50) -> List[HotTopic]:
        """
        æŠ“å–çƒ­æ¦œæ•°æ®ï¼ˆæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°ï¼‰
        
        Args:
            limit: æŠ“å–æ•°é‡é™åˆ¶
            
        Returns:
            çƒ­æ¦œè¯é¢˜åˆ—è¡¨
        """
        pass
    
    def _clean_title(self, title: str) -> str:
        """æ¸…æ´—æ ‡é¢˜æ–‡æœ¬"""
        return title.strip().replace('\n', ' ').replace('\r', '')
    
    def _is_valid_topic(self, topic: HotTopic) -> bool:
        """
        éªŒè¯è¯é¢˜æ˜¯å¦æœ‰æ•ˆï¼ˆå»é™¤å¹¿å‘Šç­‰ï¼‰
        
        Args:
            topic: è¯é¢˜å¯¹è±¡
            
        Returns:
            æ˜¯å¦æœ‰æ•ˆ
        """
        # åŸºç¡€éªŒè¯
        if not topic.title or len(topic.title) < 3:
            return False
        
        # è¿‡æ»¤å¹¿å‘Šå…³é”®è¯
        ad_keywords = ['å¹¿å‘Š', 'æ¨å¹¿', 'èµåŠ©', 'AD']
        if any(keyword in topic.title for keyword in ad_keywords):
            return False
        
        return True
```

**è®¾è®¡æ¨¡å¼**ï¼š**ç­–ç•¥æ¨¡å¼ + æ¨¡æ¿æ–¹æ³•**
- `fetch_hot_topics()` æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå„å¹³å°å®ç°ä¸åŒçš„æŠ“å–ç­–ç•¥
- `_clean_title()` å’Œ `_is_valid_topic()` æ˜¯å…¬å…±æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»å…±äº«

#### 3.2 å…·ä½“å®ç° (weibo_scraper.py)

**æ ¸å¿ƒèŒè´£**ï¼šä½¿ç”¨ Playwright æŠ“å–å¾®åšçƒ­æœæ¦œã€‚

```python
from typing import List
from playwright.async_api import async_playwright
from models import HotTopic
from .base_scraper import BaseScraper
from loguru import logger
import asyncio

class WeiboScraper(BaseScraper):
    """å¾®åšçƒ­æœçˆ¬è™«"""
    
    def __init__(self):
        super().__init__("weibo")
        self.base_url = "https://s.weibo.com/top/summary"
    
    async def fetch_hot_topics(self, limit: int = 50) -> List[HotTopic]:
        """æŠ“å–å¾®åšçƒ­æœæ¦œ"""
        topics = []
        
        try:
            async with async_playwright() as p:
                # 1. å¯åŠ¨æµè§ˆå™¨
                browser = await p.chromium.launch(headless=True)
                page = await browser.new_page()
                
                logger.info(f"æ­£åœ¨è®¿é—®å¾®åšçƒ­æœ: {self.base_url}")
                await page.goto(self.base_url, timeout=30000)
                await asyncio.sleep(2)  # ç­‰å¾…é¡µé¢åŠ è½½
                
                # 2. æŸ¥æ‰¾çƒ­æœæ¡ç›®ï¼ˆé€šè¿‡ CSS é€‰æ‹©å™¨ï¼‰
                items = await page.query_selector_all('tbody tr')
                
                # 3. é€æ¡è§£æ
                for idx, item in enumerate(items[:limit]):
                    try:
                        # æå–æ ‡é¢˜
                        title_elem = await item.query_selector('td.td-02 a')
                        if not title_elem:
                            continue
                        
                        title = await title_elem.inner_text()
                        title = self._clean_title(title)  # è°ƒç”¨åŸºç±»æ–¹æ³•æ¸…æ´—
                        
                        # æå–é“¾æ¥
                        link = await title_elem.get_attribute('href')
                        if link and not link.startswith('http'):
                            link = f"https://s.weibo.com{link}"
                        
                        # æå–çƒ­åº¦ï¼ˆä»æ–‡æœ¬ä¸­æå–æ•°å­—ï¼‰
                        heat_elem = await item.query_selector('td.td-02 span')
                        heat_score = 0
                        if heat_elem:
                            heat_text = await heat_elem.inner_text()
                            heat_score = int(''.join(filter(str.isdigit, heat_text)) or '0')
                        
                        # æå–åˆ†ç±»
                        category_elem = await item.query_selector('td.td-03')
                        category = None
                        if category_elem:
                            category = await category_elem.inner_text()
                        
                        # 4. æ„å»º HotTopic å¯¹è±¡
                        topic = HotTopic(
                            platform="weibo",
                            title=title,
                            heat_score=heat_score,
                            link=link or "",
                            discussion_volume=None,
                            category=category
                        )
                        
                        # 5. éªŒè¯å¹¶æ·»åŠ 
                        if self._is_valid_topic(topic):
                            topics.append(topic)
                            logger.debug(f"æŠ“å–åˆ°å¾®åšè¯é¢˜: {title} (çƒ­åº¦: {heat_score})")
                    
                    except Exception as e:
                        logger.warning(f"è§£æå¾®åšè¯é¢˜å¤±è´¥: {e}")
                        continue
                
                await browser.close()
                logger.success(f"å¾®åšçˆ¬è™«å®Œæˆï¼ŒæŠ“å–åˆ° {len(topics)} æ¡æœ‰æ•ˆæ•°æ®")
        
        except Exception as e:
            logger.error(f"å¾®åšçˆ¬è™«å‡ºé”™: {e}")
        
        return topics
```

##### ä»£ç æœ¬èº«å«ä¹‰

python

```
title_elem = await item.query_selector('td.td-02 a')
```

- `item`ï¼šå‰é¢å¾ªç¯é‡Œ `for idx, item in enumerate(items[:limit])` çš„é‚£ä¸ª `item`ï¼Œä¹Ÿå°±æ˜¯ **å½“å‰è¿™ä¸€è¡Œçƒ­æœå¯¹åº”çš„ `<tr>` å…ƒç´ **ã€‚
- `query_selector(...)`ï¼šPlaywright çš„æ–¹æ³•ï¼Œ**åœ¨å½“å‰å…ƒç´ å†…æŒ‰ CSS é€‰æ‹©å™¨æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­å…ƒç´ **ã€‚
- `await`ï¼šå› ä¸º Playwright æ˜¯å¼‚æ­¥ APIï¼Œé€‰æ‹©å…ƒç´ éœ€è¦ `await`ã€‚

------

##### selectorï¼š`'td.td-02 a'` çš„å«ä¹‰

è¿™æ˜¯ä¸€ä¸ªæ ‡å‡† CSS é€‰æ‹©å™¨ï¼Œæ‹†å¼€è§£é‡Šï¼š

- `td`ï¼šé€‰æ‹© `<td>` å•å…ƒæ ¼æ ‡ç­¾
- `.td-02`ï¼šç±»åä¸º `td-02` çš„å…ƒç´ ï¼ˆç­‰ä»·äº `<td class="td-02">`ï¼‰
- ç©ºæ ¼ `a`ï¼šè¡¨ç¤º **åœ¨è¿™ä¸ª `<td class="td-02">` é‡Œé¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª `<a>` å­å…ƒç´ **

åˆèµ·æ¥å°±æ˜¯ï¼š

> åœ¨å½“å‰ `item`ï¼ˆä¸€ä¸ª `<tr>`ï¼‰å†…éƒ¨ï¼Œæ‰¾åˆ°
> ã€Œclass æ˜¯ `td-02` çš„ `<td>` å…ƒç´ ã€ä¸‹é¢çš„ç¬¬ä¸€ä¸ª `<a>` æ ‡ç­¾ã€‚

é€šå¸¸å¾®åšçƒ­æœçš„ HTML ç»“æ„ç±»ä¼¼è¿™æ ·ï¼ˆç®€åŒ–ä¾‹å­ï¼‰ï¼š

html

```css
<tr>
  <td class="td-01">1</td>
  <td class="td-02">
    <a href="/weibo?q=xxx">ä¸­å›½äººèŠ±å…­åå¤šä¸‡ä¹°ä¸‹åŒ—æµ·é“ä¸‰å¥—æˆ¿</a>
    <span>958380</span>
  </td>
  <td class="td-03">çƒ­</td>
</tr>
```

åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼š

- `td.td-02` å°±æ˜¯è¿™å—ï¼š

  html

  `<td class="td-02"> ... </td>`

- `td.td-02 a` å°±æ˜¯è¿™å—ï¼š

  html

  `<a href="...">ä¸­å›½äººèŠ±å…­åå¤šä¸‡ä¹°ä¸‹åŒ—æµ·é“ä¸‰å¥—æˆ¿</a>`

ä¹Ÿå°±æ˜¯ï¼š**è¿™ä¸€è¡Œä»£ç å°±æ˜¯åœ¨æ¯ä¸€æ¡çƒ­æœ `<tr>` é‡Œæ‰¾åˆ°å¯¹åº”çš„â€œæ ‡é¢˜é“¾æ¥å…ƒç´ â€ï¼Œåé¢å†ç”¨ `.inner_text()` å–æ ‡é¢˜ï¼Œç”¨ `.get_attribute('href')` å–é“¾æ¥ã€‚**

**å…³é”®æŠ€æœ¯ç‚¹**ï¼š

- âœ… **å¼‚æ­¥ Playwright**ï¼š`async with async_playwright()` æ”¯æŒå¹¶å‘æ‰§è¡Œ
- âœ… **CSS é€‰æ‹©å™¨**ï¼š`query_selector_all('tbody tr')` å®šä½é¡µé¢å…ƒç´ 
- âœ… **å®¹é”™æœºåˆ¶**ï¼šæ¯ä¸ªè¯é¢˜è§£æå¤±è´¥ä¸å½±å“å…¶ä»–ï¼Œæœ€å¤–å±‚ try-except å…œåº•
- âœ… **æ•°æ®æ¸…æ´—**ï¼š`filter(str.isdigit, heat_text)` æå–æ•°å­—ï¼Œ`_clean_title()` æ¸…æ´—æ ‡é¢˜

**æŠ“å–æµç¨‹**ï¼š
```
1. å¯åŠ¨æ— å¤´æµè§ˆå™¨
2. è®¿é—®ç›®æ ‡ URL
3. ç­‰å¾…é¡µé¢åŠ è½½ï¼ˆasyncio.sleepï¼‰
4. æŸ¥æ‰¾æ‰€æœ‰çƒ­æœæ¡ç›®
5. é€æ¡æå–ï¼šæ ‡é¢˜ã€é“¾æ¥ã€çƒ­åº¦ã€åˆ†ç±»
6. æ„å»º HotTopic å¯¹è±¡
7. éªŒè¯æœ‰æ•ˆæ€§å¹¶æ·»åŠ åˆ°åˆ—è¡¨
8. å…³é—­æµè§ˆå™¨ï¼Œè¿”å›ç»“æœ
```

---

### 4. LLM åˆ†æå™¨ (llm_analyzer.py)

**æ ¸å¿ƒèŒè´£**ï¼šè°ƒç”¨Deepseek-chatå¯¹è¯é¢˜è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œè¯„ä¼°ç¤¾ä¼šå½±å“åŠ›å’Œè®¨è®ºæ·±åº¦ã€‚

```python
from typing import List
from langchain_openai import ChatOpenAI
from langchain.prompts import ChatPromptTemplate
from langchain.output_parsers import PydanticOutputParser
from models import HotTopic, LLMAnalysis
from config import Config
from loguru import logger
import json

class LLMAnalyzer:
    """LLM è¯­ä¹‰åˆ†æå™¨"""
    
    def __init__(self):
        # 1. åˆå§‹åŒ– LLM å®¢æˆ·ç«¯
        self.llm = ChatOpenAI(
            model=Config.LLM_MODEL,
            openai_api_key=Config.OPENAI_API_KEY,
            openai_api_base=Config.OPENAI_API_BASE,
            temperature=0.3  # è¾ƒä½æ¸©åº¦ï¼Œæ›´ç¨³å®šçš„è¾“å‡º
        )
        
        # 2. å®šä¹‰è¾“å‡ºè§£æå™¨ï¼ˆç¡®ä¿ LLM è¿”å›ç¬¦åˆ LLMAnalysis ç»“æ„çš„ JSONï¼‰
        self.parser = PydanticOutputParser(pydantic_object=LLMAnalysis)
        
        # 3. æ„å»º Prompt æ¨¡æ¿
        self.prompt = ChatPromptTemplate.from_messages([
            ("system", """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¤¾ä¼šçƒ­ç‚¹åˆ†æä¸“å®¶ï¼Œæ“…é•¿åˆ¤æ–­ç½‘ç»œè¯é¢˜çš„æ€§è´¨å’Œå½±å“åŠ›ã€‚
            
ä½ éœ€è¦åˆ†æè¯é¢˜æ ‡é¢˜ï¼Œè¯„ä¼°å…¶ï¼š
1. è¯é¢˜æ€§è´¨ï¼ˆå¨±ä¹/ç¤¾ä¼šæ–°é—»/ç§‘æŠ€/è™šå‡ä¿¡æ¯/å…¶ä»–ï¼‰
2. ç¤¾ä¼šå½±å“åŠ›ï¼ˆ1-10åˆ†ï¼‰ï¼šè¯é¢˜å¯¹ç¤¾ä¼šçš„å½±å“èŒƒå›´å’Œæ·±åº¦
3. è®¨è®ºæ·±åº¦ï¼ˆ1-10åˆ†ï¼‰ï¼šè¯é¢˜å¼•å‘æ·±åº¦æ€è€ƒå’Œè®¨è®ºçš„æ½œåŠ›
4. ç»¼åˆæ½œåŠ›åˆ†ï¼ˆ1-10åˆ†ï¼‰ï¼šç»¼åˆè¯„ä¼°è¯é¢˜æˆä¸º"ç¤¾ä¼šçº§çˆ†ç‚¹"çš„æ½œåŠ›

è¯„åˆ†æ ‡å‡†ï¼š
- 9-10åˆ†ï¼šå…¨æ°‘å…³æ³¨çš„é‡å¤§äº‹ä»¶ï¼Œå…·æœ‰æ·±è¿œå½±å“
- 7-8åˆ†ï¼šå¼•å‘å¹¿æ³›è®¨è®ºçš„çƒ­ç‚¹äº‹ä»¶
- 5-6åˆ†ï¼šæœ‰ä¸€å®šå…³æ³¨åº¦çš„æ™®é€šè¯é¢˜
- 3-4åˆ†ï¼šå°èŒƒå›´å…³æ³¨çš„è¯é¢˜
- 1-2åˆ†ï¼šå¨±ä¹æ€§è¯é¢˜æˆ–å½±å“åŠ›è¾ƒå°

{format_instructions}"""),
            ("user", """è¯·åˆ†æä»¥ä¸‹çƒ­æ¦œè¯é¢˜ï¼š

å¹³å°ï¼š{platform}
æ ‡é¢˜ï¼š{title}
åŸå§‹çƒ­åº¦ï¼š{heat_score}

è¯·è¿”å›ä¸¥æ ¼çš„JSONæ ¼å¼åˆ†æç»“æœã€‚""")
        ])
    
    async def analyze_topic(self, topic: HotTopic) -> LLMAnalysis:
        """
        åˆ†æå•ä¸ªè¯é¢˜
        
        Args:
            topic: çƒ­æ¦œè¯é¢˜å¯¹è±¡
            
        Returns:
            LLMåˆ†æç»“æœ
        """
        try:
            # 4. æ„å»ºå¤„ç†é“¾ï¼ˆPrompt + LLMï¼‰
            chain = self.prompt | self.llm
            
            # 5. è°ƒç”¨ LLM
            response = await chain.ainvoke({
                "platform": topic.platform,
                "title": topic.title,
                "heat_score": topic.heat_score,
                "format_instructions": self.parser.get_format_instructions()
            })
            
            # 6. è§£æ LLM è¿”å›çš„ JSON
            content = response.content
            
            # å¤„ç†å¯èƒ½çš„ markdown ä»£ç å—åŒ…è£¹
            if "```json" in content:
                content = content.split("```json")[1].split("```")[0].strip()
            elif "```" in content:
                content = content.split("```")[1].split("```")[0].strip()
            
            # 7. ååºåˆ—åŒ–ä¸º LLMAnalysis å¯¹è±¡
            analysis_dict = json.loads(content)
            analysis = LLMAnalysis(**analysis_dict)
            
            logger.info(f"LLMåˆ†æå®Œæˆ: {topic.title} -> æ½œåŠ›åˆ†: {analysis.potential_score}")
            return analysis
        
        except Exception as e:
            logger.error(f"LLMåˆ†æå¤±è´¥: {topic.title}, é”™è¯¯: {e}")
            # 8. è¿”å›é»˜è®¤åˆ†æç»“æœï¼ˆå…œåº•æœºåˆ¶ï¼‰
            return LLMAnalysis(
                topic_nature="æœªçŸ¥",
                social_impact=5,
                discussion_depth=5,
                potential_score=5,
                reason="åˆ†æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼"
            )
    
    async def batch_analyze(self, topics: List[HotTopic], batch_size: int = 5) -> List[LLMAnalysis]:
        """
        æ‰¹é‡åˆ†æè¯é¢˜
        
        Args:
            topics: è¯é¢˜åˆ—è¡¨
            batch_size: æ‰¹å¤„ç†å¤§å°
            
        Returns:
            åˆ†æç»“æœåˆ—è¡¨
        """
        results = []
        
        # åˆ†æ‰¹å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§è¯·æ±‚è¿‡å¤š
        for i in range(0, len(topics), batch_size):
            batch = topics[i:i+batch_size]
            logger.info(f"æ­£åœ¨åˆ†æç¬¬ {i+1}-{min(i+batch_size, len(topics))} æ¡è¯é¢˜...")
            
            for topic in batch:
                analysis = await self.analyze_topic(topic)
                results.append(analysis)
        
        return results
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… **LangChain é›†æˆ**ï¼šä½¿ç”¨ `ChatOpenAI` + `ChatPromptTemplate`ï¼Œä»£ç ç®€æ´
- âœ… **ç»“æ„åŒ–è¾“å‡º**ï¼š`PydanticOutputParser` ç¡®ä¿ LLM è¿”å›çš„ JSON ç¬¦åˆ `LLMAnalysis` ç»“æ„
- âœ… **Prompt Engineering**ï¼šè¯¦ç»†çš„è¯„åˆ†æ ‡å‡†å’Œç¤ºä¾‹ï¼Œå¼•å¯¼ LLM è¾“å‡ºå‡†ç¡®ç»“æœ
- âœ… **å®¹é”™å¤„ç†**ï¼šè§£æå¤±è´¥æ—¶è¿”å›é»˜è®¤å€¼ï¼ˆ5 åˆ†ï¼‰ï¼Œä¸é˜»å¡æµç¨‹
- âœ… **æ‰¹å¤„ç†**ï¼šé¿å…ä¸€æ¬¡æ€§å‘é€å¤§é‡è¯·æ±‚ï¼Œæ§åˆ¶å¹¶å‘

**Prompt è®¾è®¡è¦ç‚¹**ï¼š
- **è§’è‰²å®šä½**ï¼šä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¤¾ä¼šçƒ­ç‚¹åˆ†æä¸“å®¶
- **ä»»åŠ¡æ‹†è§£**ï¼šæ˜ç¡® 4 ä¸ªè¯„ä¼°ç»´åº¦
- **è¯„åˆ†æ ‡å‡†**ï¼šç»™å‡º 1-10 åˆ†çš„å…·ä½“å«ä¹‰
- **æ ¼å¼è¦æ±‚**ï¼šè¦æ±‚è¿”å›ä¸¥æ ¼çš„ JSON

---

### 5. è¯„åˆ†å¼•æ“ (scoring_engine.py)

**æ ¸å¿ƒèŒè´£**ï¼šç»¼åˆåŸå§‹çƒ­åº¦ã€è®¨è®ºé‡å’Œ LLM è¯„åˆ†ï¼Œè®¡ç®—æœ€ç»ˆå¾—åˆ†ã€‚

```python
from typing import List
import pandas as pd
from models import HotTopic, LLMAnalysis, EnrichedTopic
from config import Config
from loguru import logger

class ScoringEngine:
    """çƒ­åº¦ç»¼åˆè¯„åˆ†å¼•æ“"""
    
    def __init__(self):
        self.weight_heat = Config.WEIGHT_HEAT        # 0.5
        self.weight_discussion = Config.WEIGHT_DISCUSSION  # 0.3
        self.weight_llm = Config.WEIGHT_LLM          # 0.2
    
    def normalize(self, values: List) -> List[float]:
        """
        å½’ä¸€åŒ–åˆ° 0-100 åŒºé—´ï¼ˆMin-Max å½’ä¸€åŒ–ï¼‰
        
        å…¬å¼ï¼šnormalized = (value - min) / (max - min) * 100
        
        Args:
            values: åŸå§‹æ•°å€¼åˆ—è¡¨
            
        Returns:
            å½’ä¸€åŒ–åçš„åˆ—è¡¨
        """
        if not values or max(values) == 0:
            return [0.0] * len(values)
        
        min_val = min(values)
        max_val = max(values)
        
        # æ‰€æœ‰å€¼ç›¸åŒçš„æƒ…å†µ
        if max_val == min_val:
            return [50.0] * len(values)
        
        # Min-Max å½’ä¸€åŒ–
        return [(v - min_val) / (max_val - min_val) * 100 for v in values]
    
    def calculate_scores(
        self, 
        topics: List[HotTopic], 
        analyses: List[LLMAnalysis]
    ) -> List[EnrichedTopic]:
        """
        è®¡ç®—ç»¼åˆè¯„åˆ†
        
        æ ¸å¿ƒå…¬å¼ï¼š
        TotalScore = (å½’ä¸€åŒ–çƒ­åº¦ Ã— 0.5) 
                   + (å½’ä¸€åŒ–è®¨è®ºé‡ Ã— 0.3) 
                   + (LLMæ½œåŠ›åˆ†Ã—10 Ã— 0.2)
        
        Args:
            topics: åŸå§‹è¯é¢˜åˆ—è¡¨
            analyses: LLMåˆ†æç»“æœåˆ—è¡¨
            
        Returns:
            ç»è¿‡è¯„åˆ†çš„è¯é¢˜åˆ—è¡¨
        """
        if len(topics) != len(analyses):
            logger.error("è¯é¢˜æ•°é‡ä¸åˆ†æç»“æœæ•°é‡ä¸åŒ¹é…")
            return []
        
        # 1. æå–æ‰€æœ‰çƒ­åº¦å€¼å’Œè®¨è®ºé‡
        heat_scores = [t.heat_score for t in topics]
        discussion_volumes = [t.discussion_volume or 0 for t in topics]
        
        # 2. å½’ä¸€åŒ–åˆ° 0-100
        normalized_heats = self.normalize(heat_scores)
        normalized_discussions = self.normalize(discussion_volumes)
        
        enriched_topics = []
        
        # 3. é€ä¸ªè®¡ç®—ç»¼åˆè¯„åˆ†
        for i, (topic, analysis) in enumerate(zip(topics, analyses)):
            # è®¡ç®—ç»¼åˆè¯„åˆ†
            total_score = (
                normalized_heats[i] * self.weight_heat +
                normalized_discussions[i] * self.weight_discussion +
                (analysis.potential_score * 10) * self.weight_llm
            )
            
            # åˆ¤æ–­æ˜¯å¦ä¸ºçˆ†ç‚¹è¯é¢˜
            is_breakout = total_score >= Config.SCORE_THRESHOLD
            
            # 4. æ„å»º EnrichedTopic å¯¹è±¡
            enriched_topic = EnrichedTopic(
                platform=topic.platform,
                title=topic.title,
                heat_score=topic.heat_score,
                link=topic.link,
                discussion_volume=topic.discussion_volume,
                category=topic.category,
                llm_analysis=analysis,
                normalized_heat=round(normalized_heats[i], 2),
                normalized_discussion=round(normalized_discussions[i], 2),
                total_score=round(total_score, 2),
                is_breakout=is_breakout
            )
            
            enriched_topics.append(enriched_topic)
            
            # 5. æ‰“å°çˆ†ç‚¹è¯é¢˜
            if is_breakout:
                logger.success(
                    f"ğŸ”¥ å‘ç°çˆ†ç‚¹è¯é¢˜: {topic.title} "
                    f"(ç»¼åˆè¯„åˆ†: {total_score:.2f}, LLMæ½œåŠ›åˆ†: {analysis.potential_score})"
                )
        
        # 6. æŒ‰è¯„åˆ†æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰
        enriched_topics.sort(key=lambda x: x.total_score, reverse=True)
        
        return enriched_topics
    
    def get_statistics(self, topics: List[EnrichedTopic]) -> dict:
        """
        è·å–ç»Ÿè®¡ä¿¡æ¯
        
        Args:
            topics: è¯„åˆ†åçš„è¯é¢˜åˆ—è¡¨
            
        Returns:
            ç»Ÿè®¡å­—å…¸
        """
        df = pd.DataFrame([t.dict() for t in topics])
        
        # ä» llm_analysis ä¸­æå–è¯é¢˜æ€§è´¨ï¼Œå…¼å®¹ dict å’Œå¯¹è±¡ä¸¤ç§æƒ…å†µ
        nature_series = df["llm_analysis"].apply(
            lambda x: (
                x.get("topic_nature", "æœªçŸ¥")
                if isinstance(x, dict)
                else getattr(x, "topic_nature", "æœªçŸ¥")
            )
        )
        
        stats = {
            "total_count": len(topics),
            "breakout_count": sum(1 for t in topics if t.is_breakout),
            "avg_score": df['total_score'].mean(),
            "max_score": df['total_score'].max(),
            "min_score": df['total_score'].min(),
            "platform_distribution": df['platform'].value_counts().to_dict(),
            "nature_distribution": nature_series.value_counts().to_dict()
        }
        
        return stats
```

**æ ¸å¿ƒç®—æ³•è§£æ**ï¼š

#### å½’ä¸€åŒ–å¤„ç†
**ä¸ºä»€ä¹ˆéœ€è¦å½’ä¸€åŒ–ï¼Ÿ**
- å¾®åšçƒ­åº¦å€¼å¯èƒ½æ˜¯å‡ ç™¾ä¸‡
- çŸ¥ä¹çƒ­åº¦å€¼å¯èƒ½åªæœ‰å‡ ä¸‡
- ç›´æ¥ç›¸åŠ ä¼šè¢«å¾®åšä¸»å¯¼ï¼Œä¸å…¬å¹³

**Min-Max å½’ä¸€åŒ–å…¬å¼**ï¼š
```
normalized = (value - min) / (max - min) Ã— 100
```

**ç¤ºä¾‹**ï¼š
```python
åŸå§‹çƒ­åº¦ï¼š[1000000, 500000, 200000]
æœ€å°å€¼ï¼š200000ï¼Œæœ€å¤§å€¼ï¼š1000000

å½’ä¸€åŒ–åï¼š
- 1000000 â†’ (1000000-200000)/(1000000-200000) Ã— 100 = 100
- 500000  â†’ (500000-200000)/(1000000-200000) Ã— 100 = 37.5
- 200000  â†’ (200000-200000)/(1000000-200000) Ã— 100 = 0
```

#### ç»¼åˆè¯„åˆ†å…¬å¼
```
TotalScore = (å½’ä¸€åŒ–çƒ­åº¦ Ã— 0.5) 
           + (å½’ä¸€åŒ–è®¨è®ºé‡ Ã— 0.3) 
           + (LLMæ½œåŠ›åˆ†Ã—10 Ã— 0.2)
```

**æƒé‡è§£é‡Š**ï¼š
- **çƒ­åº¦ 50%**ï¼šåŸå§‹çƒ­åº¦æœ€é‡è¦ï¼Œæ˜¯è¯é¢˜çƒ­åº¦çš„ç›´æ¥ä½“ç°
- **è®¨è®ºé‡ 30%**ï¼šè¯„è®º/å›ç­”æ•°åæ˜ å‚ä¸åº¦å’Œæ·±åº¦
- **LLMè¯„åˆ† 20%**ï¼šè¯­ä¹‰åˆ†ææä¾›è´¨é‡è¯„ä¼°ï¼Œé˜²æ­¢çº¯çƒ­åº¦è¯¯å¯¼

**ä¸ºä»€ä¹ˆ LLM æ½œåŠ›åˆ†è¦ Ã—10ï¼Ÿ**
- LLM è¿”å›çš„æ˜¯ 1-10 åˆ†
- ä¹˜ä»¥ 10 åå˜ä¸º 10-100ï¼Œä¸å½’ä¸€åŒ–åçš„çƒ­åº¦/è®¨è®ºé‡ä¿æŒåŒä¸€é‡çº§

---

### 6. Agent ä¸»æ§ (agent.py)

**æ ¸å¿ƒèŒè´£**ï¼šåè°ƒæ‰€æœ‰æ¨¡å—ï¼Œæ‰§è¡Œå®Œæ•´çš„"æŠ“å–-åˆ†æ-è¯„åˆ†-ä¿å­˜"æµç¨‹ã€‚

```python
import asyncio
from typing import List
from datetime import datetime
import json
from pathlib import Path

from scrapers import WeiboScraper, DouyinScraper, ZhihuScraper
from llm_analyzer import LLMAnalyzer
from scoring_engine import ScoringEngine
from models import EnrichedTopic
from config import Config
from loguru import logger

class HotTopicAgent:
    """çƒ­æ¦œåˆ†æ Agent ä¸»æ§åˆ¶å™¨"""
    
    def __init__(self):
        # åˆå§‹åŒ–ä¸‰ä¸ªå¹³å°çš„çˆ¬è™«
        self.scrapers = {
            "weibo": WeiboScraper(),
            "douyin": DouyinScraper(),
            "zhihu": ZhihuScraper()
        }
        self.analyzer = LLMAnalyzer()
        self.scoring_engine = ScoringEngine()
        
        logger.info("çƒ­æ¦œ Agent åˆå§‹åŒ–å®Œæˆ")
    
    async def scrape_all_platforms(self) -> List:
        """å¹¶å‘æŠ“å–æ‰€æœ‰å¹³å°æ•°æ®"""
        logger.info("=" * 60)
        logger.info("ğŸš€ å¼€å§‹æŠ“å–å¤šå¹³å°çƒ­æ¦œæ•°æ®")
        logger.info("=" * 60)
        
        # 1. æ„å»ºä»»åŠ¡åˆ—è¡¨
        tasks = []
        for platform, scraper in self.scrapers.items():
            if Config.PLATFORMS[platform]["enabled"]:
                tasks.append(scraper.fetch_hot_topics(limit=Config.FETCH_LIMIT))
        
        # 2. å¹¶å‘æ‰§è¡Œæ‰€æœ‰çˆ¬è™«ä»»åŠ¡
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # 3. æ±‡æ€»ç»“æœ
        all_topics = []
        for result in results:
            if isinstance(result, list):
                all_topics.extend(result)
            else:
                logger.error(f"æŠ“å–å‡ºé”™: {result}")
        
        logger.info(f"âœ… æŠ“å–å®Œæˆï¼Œå…±è·å¾— {len(all_topics)} æ¡è¯é¢˜")
        return all_topics
    
    def deduplicate_topics(self, topics: List) -> List:
        """å»é‡ï¼šç§»é™¤é‡å¤è¯é¢˜"""
        seen_titles = set()
        unique_topics = []
        
        for topic in topics:
            title_lower = topic.title.lower()
            if title_lower not in seen_titles:
                seen_titles.add(title_lower)
                unique_topics.append(topic)
        
        removed_count = len(topics) - len(unique_topics)
        if removed_count > 0:
            logger.info(f"ğŸ§¹ å»é‡å®Œæˆï¼Œç§»é™¤ {removed_count} æ¡é‡å¤è¯é¢˜")
        
        return unique_topics
    
    async def analyze_and_score(self, topics: List) -> List[EnrichedTopic]:
        """åˆ†æå¹¶è¯„åˆ†"""
        logger.info("=" * 60)
        logger.info("ğŸ¤– å¼€å§‹ LLM è¯­ä¹‰åˆ†æ")
        logger.info("=" * 60)
        
        # 1. LLM æ‰¹é‡åˆ†æ
        analyses = await self.analyzer.batch_analyze(topics)
        
        logger.info("=" * 60)
        logger.info("ğŸ“Š å¼€å§‹è®¡ç®—ç»¼åˆè¯„åˆ†")
        logger.info("=" * 60)
        
        # 2. è®¡ç®—ç»¼åˆè¯„åˆ†
        enriched_topics = self.scoring_engine.calculate_scores(topics, analyses)
        
        return enriched_topics
    
    def save_results(self, topics: List[EnrichedTopic], timestamp: str):
        """ä¿å­˜ç»“æœåˆ° JSON æ–‡ä»¶"""
        output_dir = Path(Config.OUTPUT_DIR)
        output_dir.mkdir(exist_ok=True)
        
        # 1. ä¿å­˜æ‰€æœ‰è¯é¢˜
        all_file = output_dir / f"all_topics_{timestamp}.json"
        with open(all_file, 'w', encoding='utf-8') as f:
            data = [t.dict() for t in topics]
            json.dump(data, f, ensure_ascii=False, indent=2)
        
        logger.info(f"ğŸ’¾ æ‰€æœ‰è¯é¢˜å·²ä¿å­˜: {all_file}")
        
        # 2. ä¿å­˜çˆ†ç‚¹è¯é¢˜
        breakout_topics = [t for t in topics if t.is_breakout]
        if breakout_topics:
            breakout_file = output_dir / f"breakout_topics_{timestamp}.json"
            with open(breakout_file, 'w', encoding='utf-8') as f:
                data = [t.dict() for t in breakout_topics]
                json.dump(data, f, ensure_ascii=False, indent=2)
            
            logger.success(f"ğŸ”¥ çˆ†ç‚¹è¯é¢˜å·²ä¿å­˜: {breakout_file} (å…± {len(breakout_topics)} æ¡)")
        
        # 3. ä¿å­˜ç»Ÿè®¡ä¿¡æ¯
        stats = self.scoring_engine.get_statistics(topics)
        stats_file = output_dir / f"statistics_{timestamp}.json"
        with open(stats_file, 'w', encoding='utf-8') as f:
            json.dump(stats, f, ensure_ascii=False, indent=2)
        
        logger.info(f"ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯å·²ä¿å­˜: {stats_file}")
        
        return breakout_topics
    
    async def run(self):
        """æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„æŠ“å–-åˆ†æ-è¯„åˆ†æµç¨‹"""
        try:
            start_time = datetime.now()
            timestamp = start_time.strftime("%Y%m%d_%H%M%S")
            
            logger.info(f"\n{'='*60}")
            logger.info(f"ğŸ¯ çƒ­æ¦œ Agent å¼€å§‹æ‰§è¡Œ - {start_time.strftime('%Y-%m-%d %H:%M:%S')}")
            logger.info(f"{'='*60}\n")
            
            # æ­¥éª¤ 1: æŠ“å–æ•°æ®
            all_topics = await self.scrape_all_platforms()
            
            if not all_topics:
                logger.warning("âš ï¸ æœªæŠ“å–åˆ°ä»»ä½•æ•°æ®ï¼Œæœ¬æ¬¡ä»»åŠ¡ç»“æŸ")
                return
            
            # æ­¥éª¤ 2: å»é‡
            unique_topics = self.deduplicate_topics(all_topics)
            
            # æ­¥éª¤ 3: åˆ†æå’Œè¯„åˆ†
            enriched_topics = await self.analyze_and_score(unique_topics)
            
            # æ­¥éª¤ 4: ä¿å­˜ç»“æœ
            breakout_topics = self.save_results(enriched_topics, timestamp)
            
            # æ­¥éª¤ 5: è¾“å‡ºæ‘˜è¦
            end_time = datetime.now()
            duration = (end_time - start_time).total_seconds()
            
            logger.info(f"\n{'='*60}")
            logger.info("ğŸ“‹ æ‰§è¡Œæ‘˜è¦")
            logger.info(f"{'='*60}")
            logger.info(f"æ€»è¯é¢˜æ•°: {len(enriched_topics)}")
            logger.info(f"çˆ†ç‚¹è¯é¢˜æ•°: {len(breakout_topics)}")
            logger.info(f"æ‰§è¡Œè€—æ—¶: {duration:.2f} ç§’")
            logger.info(f"{'='*60}\n")
            
            # æ˜¾ç¤º Top 5 çˆ†ç‚¹è¯é¢˜
            if breakout_topics:
                logger.info("ğŸ† Top 5 çˆ†ç‚¹è¯é¢˜:")
                for i, topic in enumerate(breakout_topics[:5], 1):
                    logger.info(
                        f"{i}. [{topic.platform}] {topic.title} "
                        f"(è¯„åˆ†: {topic.total_score:.2f}, æ€§è´¨: {topic.llm_analysis.topic_nature})"
                    )
        
        except Exception as e:
            logger.exception(f"âŒ Agent æ‰§è¡Œå‡ºé”™: {e}")
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  run()                        â”‚
â”‚              ä¸»æ§æµç¨‹å…¥å£                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: scrape_all_platforms()                â”‚
â”‚ - å¹¶å‘å¯åŠ¨ 3 ä¸ªçˆ¬è™«                           â”‚
â”‚ - asyncio.gather() ç­‰å¾…æ‰€æœ‰å®Œæˆ               â”‚
â”‚ - æ±‡æ€»ç»“æœ â†’ List[HotTopic]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: deduplicate_topics()                  â”‚
â”‚ - å»é™¤æ ‡é¢˜é‡å¤çš„è¯é¢˜                          â”‚
â”‚ - ä½¿ç”¨ set è®°å½•å·²è§è¿‡çš„æ ‡é¢˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: analyze_and_score()                   â”‚
â”‚ â”œâ”€ analyzer.batch_analyze()                  â”‚
â”‚ â”‚  â””â”€ LLM åˆ†ææ¯ä¸ªè¯é¢˜ â†’ List[LLMAnalysis]   â”‚
â”‚ â””â”€ scoring_engine.calculate_scores()         â”‚
â”‚    â””â”€ è®¡ç®—ç»¼åˆè¯„åˆ† â†’ List[EnrichedTopic]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: save_results()                        â”‚
â”‚ - ä¿å­˜æ‰€æœ‰è¯é¢˜åˆ° JSON                        â”‚
â”‚ - ç­›é€‰å¹¶ä¿å­˜çˆ†ç‚¹è¯é¢˜                         â”‚
â”‚ - ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤5: è¾“å‡ºæ‰§è¡Œæ‘˜è¦                          â”‚
â”‚ - æ€»è¯é¢˜æ•°ã€çˆ†ç‚¹æ•°ã€è€—æ—¶                     â”‚
â”‚ - æ˜¾ç¤º Top 5 çˆ†ç‚¹è¯é¢˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âœ… **å¹¶å‘çˆ¬å–**ï¼š`asyncio.gather()` åŒæ—¶æ‰§è¡Œ 3 ä¸ªçˆ¬è™«ï¼Œæ•ˆç‡é«˜
- âœ… **èŒè´£åˆ†ç¦»**ï¼šæ¯ä¸ªæ­¥éª¤ç‹¬ç«‹æˆæ–¹æ³•ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
- âœ… **å®¹é”™æœºåˆ¶**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰å¼‚å¸¸å¤„ç†ï¼Œä¸ä¼šå› å•ä¸ªå¤±è´¥è€Œä¸­æ–­
- âœ… **å¯è§‚æµ‹æ€§**ï¼šè¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰è¿›åº¦æç¤º

---

### 7. ç¨‹åºå…¥å£ (main.py)

**æ ¸å¿ƒèŒè´£**ï¼šåˆå§‹åŒ–æ—¥å¿—ã€éªŒè¯é…ç½®ã€å¯åŠ¨ Agentã€‚

```python
import sys
import asyncio
from loguru import logger
from config import Config
from agent import HotTopicAgent
from scheduler import AgentScheduler

def setup_logger():
    """é…ç½®æ—¥å¿—"""
    logger.remove()  # ç§»é™¤é»˜è®¤å¤„ç†å™¨
    
    # 1. æ§åˆ¶å°æ—¥å¿—ï¼ˆå½©è‰²è¾“å‡ºï¼‰
    logger.add(
        sys.stdout,
        colorize=True,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <level>{message}</level>"
    )
    
    # 2. æ–‡ä»¶æ—¥å¿—ï¼ˆæ¯å¤©è½®è½¬ï¼Œä¿ç•™ 30 å¤©ï¼‰
    logger.add(
        "logs/agent_{time:YYYY-MM-DD}.log",
        rotation="00:00",        # æ¯å¤© 00:00 è½®è½¬
        retention="30 days",     # ä¿ç•™ 30 å¤©
        encoding="utf-8",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {message}"
    )

def main():
    """ä¸»å…¥å£"""
    setup_logger()
    
    logger.info("=" * 60)
    logger.info("ğŸ¤– çƒ­æ¦œåˆ†æ Agent å¯åŠ¨")
    logger.info("=" * 60)
    
    try:
        # 1. éªŒè¯é…ç½®
        Config.validate()
        logger.info("âœ… é…ç½®éªŒè¯é€šè¿‡")
        
        # 2. é€‰æ‹©è¿è¡Œæ¨¡å¼
        mode = input("\nè¯·é€‰æ‹©è¿è¡Œæ¨¡å¼:\n1. å•æ¬¡æ‰§è¡Œ\n2. å®šæ—¶è°ƒåº¦\nè¯·è¾“å…¥(1/2): ").strip()
        
        if mode == "1":
            # å•æ¬¡æ‰§è¡Œæ¨¡å¼
            logger.info("ğŸ“Œ å•æ¬¡æ‰§è¡Œæ¨¡å¼")
            agent = HotTopicAgent()
            asyncio.run(agent.run())
        
        elif mode == "2":
            # å®šæ—¶è°ƒåº¦æ¨¡å¼
            logger.info("ğŸ“Œ å®šæ—¶è°ƒåº¦æ¨¡å¼")
            scheduler = AgentScheduler()
            scheduler.start(run_immediately=True)
        
        else:
            logger.error("æ— æ•ˆçš„é€‰æ‹©ï¼Œç¨‹åºé€€å‡º")
            sys.exit(1)
    
    except KeyboardInterrupt:
        logger.info("\nğŸ‘‹ ç¨‹åºå·²åœæ­¢")
    except Exception as e:
        logger.exception(f"âŒ ç¨‹åºå¼‚å¸¸: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

**æ—¥å¿—è®¾è®¡**ï¼š
- **æ§åˆ¶å°æ—¥å¿—**ï¼šå½©è‰²è¾“å‡ºï¼Œä¾¿äºå®æ—¶æŸ¥çœ‹
- **æ–‡ä»¶æ—¥å¿—**ï¼šæ¯å¤©è½®è½¬ï¼Œé¿å…å•ä¸ªæ–‡ä»¶è¿‡å¤§
- **ä¿ç•™ç­–ç•¥**ï¼š30 å¤©è‡ªåŠ¨åˆ é™¤æ—§æ—¥å¿—

**è¿è¡Œæ¨¡å¼**ï¼š
- **å•æ¬¡æ‰§è¡Œ**ï¼šè¿è¡Œä¸€æ¬¡åé€€å‡ºï¼Œé€‚åˆæµ‹è¯•
- **å®šæ—¶è°ƒåº¦**ï¼šæ¯éš” N å°æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

---

## æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .env æ–‡ä»¶  â”‚  é…ç½®åŠ è½½
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Config ç±»                        â”‚
â”‚  (åŠ è½½å¹¶éªŒè¯æ‰€æœ‰é…ç½®å‚æ•°)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           HotTopicAgent åˆå§‹åŒ–                â”‚
â”‚  â”œâ”€ åˆ›å»º 3 ä¸ªçˆ¬è™«å®ä¾‹                         â”‚
â”‚  â”œâ”€ åˆ›å»º LLM åˆ†æå™¨                          â”‚
â”‚  â””â”€ åˆ›å»ºè¯„åˆ†å¼•æ“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ­¥éª¤1: å¹¶å‘æŠ“å– (Scrapers)                â”‚
â”‚                                               â”‚
â”‚  WeiboScraper  â”€â”                            â”‚
â”‚  DouyinScraper â”€â”¼â”€ asyncio.gather()          â”‚
â”‚  ZhihuScraper  â”€â”˜                            â”‚
â”‚                                               â”‚
â”‚  è¾“å‡º: List[HotTopic]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ­¥éª¤2: å»é‡ (Deduplication)           â”‚
â”‚                                               â”‚
â”‚  - ç§»é™¤æ ‡é¢˜é‡å¤çš„è¯é¢˜                         â”‚
â”‚  - ä½¿ç”¨ set è¿½è¸ªå·²è§æ ‡é¢˜                     â”‚
â”‚                                               â”‚
â”‚  è¾“å‡º: List[HotTopic] (å»é‡å)               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ­¥éª¤3a: LLM åˆ†æ (LLMAnalyzer)          â”‚
â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  å¯¹æ¯ä¸ª HotTopic:              â”‚           â”‚
â”‚  â”‚  1. æ„å»º Prompt               â”‚           â”‚
â”‚  â”‚  2. è°ƒç”¨ Deepseek-chat        â”‚           â”‚
â”‚  â”‚  3. è§£æ JSON ç»“æœ            â”‚           â”‚
â”‚  â”‚  4. è¿”å› LLMAnalysis          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                               â”‚
â”‚  è¾“å‡º: List[LLMAnalysis]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ­¥éª¤3b: è¯„åˆ†è®¡ç®— (ScoringEngine)         â”‚
â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  1. å½’ä¸€åŒ–çƒ­åº¦å€¼               â”‚           â”‚
â”‚  â”‚  2. å½’ä¸€åŒ–è®¨è®ºé‡               â”‚           â”‚
â”‚  â”‚  3. åŠ æƒè®¡ç®—ç»¼åˆè¯„åˆ†           â”‚           â”‚
â”‚  â”‚     = çƒ­åº¦Ã—0.5                â”‚           â”‚
â”‚  â”‚     + è®¨è®ºÃ—0.3                â”‚           â”‚
â”‚  â”‚     + LLMÃ—0.2                 â”‚           â”‚
â”‚  â”‚  4. åˆ¤æ–­æ˜¯å¦ä¸ºçˆ†ç‚¹             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                               â”‚
â”‚  è¾“å‡º: List[EnrichedTopic]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ­¥éª¤4: ä¿å­˜ç»“æœ (JSON)                â”‚
â”‚                                               â”‚
â”‚  â”œâ”€ all_topics_YYYYMMDD_HHMMSS.json         â”‚
â”‚  â”‚  (æ‰€æœ‰è¯é¢˜)                               â”‚
â”‚  â”‚                                            â”‚
â”‚  â”œâ”€ breakout_topics_YYYYMMDD_HHMMSS.json    â”‚
â”‚  â”‚  (çˆ†ç‚¹è¯é¢˜ï¼Œè¯„åˆ†â‰¥80)                      â”‚
â”‚  â”‚                                            â”‚
â”‚  â””â”€ statistics_YYYYMMDD_HHMMSS.json         â”‚
â”‚     (ç»Ÿè®¡ä¿¡æ¯)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…³é”®è®¾è®¡æ¨¡å¼

### 1. **ç­–ç•¥æ¨¡å¼ (Strategy Pattern)**
**åº”ç”¨åœºæ™¯**ï¼šçˆ¬è™«ç³»ç»Ÿ

```python
# å®šä¹‰ç»Ÿä¸€æ¥å£
class BaseScraper(ABC):
    @abstractmethod
    async def fetch_hot_topics(self, limit: int) -> List[HotTopic]:
        pass

# ä¸åŒå¹³å°å®ç°ä¸åŒç­–ç•¥
class WeiboScraper(BaseScraper):
    async def fetch_hot_topics(self, limit: int):
        # å¾®åšçš„æŠ“å–é€»è¾‘
        pass

class ZhihuScraper(BaseScraper):
    async def fetch_hot_topics(self, limit: int):
        # çŸ¥ä¹çš„æŠ“å–é€»è¾‘
        pass
```

**ä¼˜ç‚¹**ï¼š
- æ–°å¢å¹³å°åªéœ€ç»§æ‰¿ `BaseScraper`ï¼Œä¸å½±å“å…¶ä»–ä»£ç 
- å„å¹³å°çˆ¬è™«äº’ä¸å¹²æ‰°ï¼Œæ˜“äºç»´æŠ¤

### 2. **æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method Pattern)**
**åº”ç”¨åœºæ™¯**ï¼šAgent ä¸»æµç¨‹

```python
async def run(self):
    # å›ºå®šçš„æ‰§è¡Œæ­¥éª¤
    all_topics = await self.scrape_all_platforms()
    unique_topics = self.deduplicate_topics(all_topics)
    enriched_topics = await self.analyze_and_score(unique_topics)
    self.save_results(enriched_topics, timestamp)
```

**ä¼˜ç‚¹**ï¼š
- ä¸»æµç¨‹å›ºå®šï¼Œå­æ­¥éª¤å¯çµæ´»æ›¿æ¢
- æ¯ä¸ªæ­¥éª¤ç‹¬ç«‹æµ‹è¯•

### 3. **å·¥å‚æ¨¡å¼ (Factory Pattern)**
**åº”ç”¨åœºæ™¯**ï¼šAgent åˆå§‹åŒ–

```python
def __init__(self):
    self.scrapers = {
        "weibo": WeiboScraper(),
        "douyin": DouyinScraper(),
        "zhihu": ZhihuScraper()
    }
```

**ä¼˜ç‚¹**ï¼š
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çˆ¬è™«å®ä¾‹
- é€šè¿‡é…ç½®å¼€å…³æ§åˆ¶å¯ç”¨å“ªäº›å¹³å°

### 4. **è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)**
**åº”ç”¨åœºæ™¯**ï¼šæ•°æ®å¤„ç†æµæ°´çº¿

```
HotTopic â†’ LLMAnalysis â†’ EnrichedTopic
```

æ¯ä¸ªé˜¶æ®µè´Ÿè´£æ•°æ®çš„ä¸€éƒ¨åˆ†å¢å¼ºï¼Œæœ€ç»ˆå¾—åˆ°å®Œæ•´ç»“æœã€‚

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿
1. âœ… **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œä½è€¦åˆé«˜å†…èš
2. âœ… **å¼‚æ­¥å¹¶å‘**ï¼šPlaywright + asyncio æå‡çˆ¬å–æ•ˆç‡
3. âœ… **ç±»å‹å®‰å…¨**ï¼šPydantic ç¡®ä¿æ•°æ®ç»“æ„æ­£ç¡®
4. âœ… **å®¹é”™æœºåˆ¶**ï¼šæ¯ä¸ªç¯èŠ‚éƒ½æœ‰å¼‚å¸¸å¤„ç†å’Œå…œåº•æ–¹æ¡ˆ
5. âœ… **å¯è§‚æµ‹æ€§**ï¼šå®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
6. âœ… **å¯æ‰©å±•æ€§**ï¼šæ–°å¢å¹³å°/ä¿®æ”¹ç®—æ³•éƒ½å¾ˆç®€å•

### æŠ€æœ¯æ ˆæ€»ç»“
- **è¯­è¨€**ï¼šPython 3.10+
- **çˆ¬è™«**ï¼šPlaywright (å¼‚æ­¥æµè§ˆå™¨è‡ªåŠ¨åŒ–)
- **LLM**ï¼šLangChain + OpenAI GPT-4
- **æ•°æ®éªŒè¯**ï¼šPydantic
- **æ•°æ®å¤„ç†**ï¼šPandas
- **æ—¥å¿—**ï¼šLoguru
- **è°ƒåº¦**ï¼šschedule

### å…³é”®æŒ‡æ ‡
- **å•æ¬¡æ‰§è¡Œè€—æ—¶**ï¼šçº¦ 2-5 åˆ†é’Ÿï¼ˆ50 æ¡è¯é¢˜ï¼‰
- **çˆ¬å–æˆåŠŸç‡**ï¼š90%+ï¼ˆå—ç½‘ç«™åçˆ¬å½±å“ï¼‰
- **LLM åˆ†æå‡†ç¡®ç‡**ï¼šä¾èµ– GPT-4 èƒ½åŠ›
- **è¯„åˆ†å…¬å¼**ï¼šçƒ­åº¦ 50% + è®¨è®º 30% + LLM 20%

---

## ä¸‹ä¸€æ­¥æ‰©å±•å»ºè®®

1. **æ–°å¢å¹³å°**ï¼šå°çº¢ä¹¦ã€Bç«™ç­‰
2. **æ•°æ®åº“å­˜å‚¨**ï¼šSQLite/PostgreSQL æ›¿ä»£ JSON
3. **è¶‹åŠ¿åˆ†æ**ï¼šå†å²æ•°æ®å¯¹æ¯”ï¼Œå‘ç°ä¸Šå‡è¶‹åŠ¿
4. **æ¨é€é€šçŸ¥**ï¼šé’‰é’‰/ä¼ä¸šå¾®ä¿¡æœºå™¨äººæ¨é€çˆ†ç‚¹è¯é¢˜
5. **å¯è§†åŒ– Dashboard**ï¼šWeb ç•Œé¢å±•ç¤ºç»“æœ
6. **æƒ…æ„Ÿåˆ†æ**ï¼šç»†åŒ–è¯é¢˜æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¶é—´**ï¼š2026-01-12  
**ä½œè€…**ï¼šHotPAgent Team
